# プロセス管理

## プロセススケジューラとは

- プログラムを動かすと、プロセスが起動する。プロセスにはCPUを割り当てる必要があり、その役割を担っている。これによって、以下のようなことを実現する。
    - リソースの効率的な利用
    - スループット (単位時間あたりに処理するプロセス数) の最大化
    - レイテンシーの最適化
    - 公平性の担保
- CPUのリソース割り当ては時間で区切られ、複数のプロセスが同時に動く (タイムシェアリングシステム)。プロセスにCPUが割り当てられている時間をタイムスライスと呼ぶ。
- CPUの割り当て対象はタスクと呼ばれる。
- CPUの割り当てを変更して実行するプロセスを切り替えることをコンテキストスイッチと呼ぶ。

## プロセスの状態

`ps -l` コマンドで状態を確認できる。

- RUNNING: 実行中 or CPUの割り当て待ち
- INTERRUPTIBLE: ユーザーから中断可能な待ち状態
- UNINTERRUPTIBLE: ユーザーから中断できない待ち状態
- DEAD: プロセスが終了した状態
- STOPPED: STOPシグナルによって停止させられている状態

## スケジューリングポリシー

プロセスごとに利用するポリシーを選択できる。3つのクラスがあり、deadline -> realtime -> fair の順で処理される。

### deadlineクラス

一定の期間ごとにデッドラインが来る処理、すなわち、ある期限までに必ず終了させる処理の場合に利用される。最もはやく期限をむかえるプロセス優先するアルゴリズム (Early deadline first; EDF) が採用される。

### realtimeクラス

物理的な装置の制御を扱う場合には、実世界で厳密に時間を守る必要がある。
この場合には、リアルタイムスケジューラーを選択する。優先度順が必要になるため、リアルタイム優先度の設定が必要。
O(1)スケジューリングアルゴリズムによって、realtimeクラス内のスケジューリングが決定される。

- FIFO
  - リアルタイム優先度順に処理する
  - 処理が終わる or プロセスが自ら手放す ot より優先度の高いものがくるまで、CPUを使う
- Round Robin
  - 実行可能状態にあるプロセスに一定時間単位を割り当て、順番にリソースを割り当てる。終了しない場合は、待ち行列の最後に回す

### fairクラス

- Completely Fair Scheduler (CFS)
   - デフォルトのアルゴリズム
   - 基本的には、実行可能状態のプロセスにタイムスライスを均等に割り当てる
   - nice値と呼ばれる値が優先度を決定する (低いほど優先度高)
   - nice値に応じて、割り当てられる時間に差が出るように調整される
   - EEVDFという方式に置き換えられつつある
- (他は省略)

